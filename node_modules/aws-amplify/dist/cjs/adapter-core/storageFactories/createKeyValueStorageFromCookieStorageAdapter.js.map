{"version":3,"file":"createKeyValueStorageFromCookieStorageAdapter.js","sources":["../../../../src/adapter-core/storageFactories/createKeyValueStorageFromCookieStorageAdapter.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createKeyValueStorageFromCookieStorageAdapter = exports.defaultSetCookieOptions = void 0;\nconst constants_1 = require(\"../constants\");\nexports.defaultSetCookieOptions = {\n    // TODO: allow configure with a public interface\n    sameSite: 'lax',\n    secure: true,\n    path: '/',\n};\n/**\n * Creates a Key Value storage interface using the `cookieStorageAdapter` as the\n * underlying storage.\n * @param cookieStorageAdapter An implementation of the `Adapter` in {@link CookieStorage}.\n * @returns An object that implements {@link KeyValueStorageInterface}.\n */\nconst createKeyValueStorageFromCookieStorageAdapter = (cookieStorageAdapter, validator, setCookieOptions = {}) => {\n    return {\n        setItem(key, value) {\n            // Delete the cookie item first then set it. This results:\n            // SetCookie: key=;expires=1970-01-01;(path='current-path') <- remove path'ed cookies\n            // SetCookie: key=value;expires=Date.now() + 365 days;path=/;secure=true\n            cookieStorageAdapter.delete(key);\n            const mergedCookieOptions = {\n                ...exports.defaultSetCookieOptions,\n                ...setCookieOptions,\n            };\n            // when expires and maxAge both are not specified, we set a default maxAge\n            if (!mergedCookieOptions.expires && !mergedCookieOptions.maxAge) {\n                mergedCookieOptions.maxAge = constants_1.DEFAULT_AUTH_TOKEN_COOKIES_MAX_AGE;\n            }\n            cookieStorageAdapter.set(key, value, mergedCookieOptions);\n            return Promise.resolve();\n        },\n        async getItem(key) {\n            const cookie = cookieStorageAdapter.get(key);\n            const value = cookie?.value ?? null;\n            if (value && validator?.getItem) {\n                const isValid = await validator.getItem(key, value);\n                if (!isValid)\n                    return null;\n            }\n            return value;\n        },\n        removeItem(key) {\n            cookieStorageAdapter.delete(key);\n            return Promise.resolve();\n        },\n        clear() {\n            // TODO(HuiSF): follow up the implementation.\n            throw new Error('This method has not implemented.');\n        },\n    };\n};\nexports.createKeyValueStorageFromCookieStorageAdapter = createKeyValueStorageFromCookieStorageAdapter;\n"],"names":[],"mappings":";;AACA;AACA;AACA,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;AAC7D,OAAO,CAAC,6CAA6C,GAAG,OAAO,CAAC,uBAAuB,GAAG,MAAM;AAChG,MAAM,WAAW,GAAG,OAAO,CAAC,cAAc,CAAC;AAC3C,OAAO,CAAC,uBAAuB,GAAG;AAClC;AACA,IAAI,QAAQ,EAAE,KAAK;AACnB,IAAI,MAAM,EAAE,IAAI;AAChB,IAAI,IAAI,EAAE,GAAG;AACb,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,6CAA6C,GAAG,CAAC,oBAAoB,EAAE,SAAS,EAAE,gBAAgB,GAAG,EAAE,KAAK;AAClH,IAAI,OAAO;AACX,QAAQ,OAAO,CAAC,GAAG,EAAE,KAAK,EAAE;AAC5B;AACA;AACA;AACA,YAAY,oBAAoB,CAAC,MAAM,CAAC,GAAG,CAAC;AAC5C,YAAY,MAAM,mBAAmB,GAAG;AACxC,gBAAgB,GAAG,OAAO,CAAC,uBAAuB;AAClD,gBAAgB,GAAG,gBAAgB;AACnC,aAAa;AACb;AACA,YAAY,IAAI,CAAC,mBAAmB,CAAC,OAAO,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE;AAC7E,gBAAgB,mBAAmB,CAAC,MAAM,GAAG,WAAW,CAAC,kCAAkC;AAC3F;AACA,YAAY,oBAAoB,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,EAAE,mBAAmB,CAAC;AACrE,YAAY,OAAO,OAAO,CAAC,OAAO,EAAE;AACpC,SAAS;AACT,QAAQ,MAAM,OAAO,CAAC,GAAG,EAAE;AAC3B,YAAY,MAAM,MAAM,GAAG,oBAAoB,CAAC,GAAG,CAAC,GAAG,CAAC;AACxD,YAAY,MAAM,KAAK,GAAG,MAAM,EAAE,KAAK,IAAI,IAAI;AAC/C,YAAY,IAAI,KAAK,IAAI,SAAS,EAAE,OAAO,EAAE;AAC7C,gBAAgB,MAAM,OAAO,GAAG,MAAM,SAAS,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC;AACnE,gBAAgB,IAAI,CAAC,OAAO;AAC5B,oBAAoB,OAAO,IAAI;AAC/B;AACA,YAAY,OAAO,KAAK;AACxB,SAAS;AACT,QAAQ,UAAU,CAAC,GAAG,EAAE;AACxB,YAAY,oBAAoB,CAAC,MAAM,CAAC,GAAG,CAAC;AAC5C,YAAY,OAAO,OAAO,CAAC,OAAO,EAAE;AACpC,SAAS;AACT,QAAQ,KAAK,GAAG;AAChB;AACA,YAAY,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC;AAC/D,SAAS;AACT,KAAK;AACL,CAAC;AACD,OAAO,CAAC,6CAA6C,GAAG,6CAA6C;;"}