{"version":3,"file":"contentSha256middleware.js","sources":["../../../../../../../src/providers/s3/utils/client/runtime/contentSha256middleware.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.contentSha256MiddlewareFactory = void 0;\nconst aws_client_utils_1 = require(\"@aws-amplify/core/internals/aws-client-utils\");\nconst constants_1 = require(\"./constants\");\n/**\n * A middleware that adds the x-amz-content-sha256 header to the request if it is not already present.\n * It's required for S3 requests in browsers where the request body is sent in 1 chunk.\n * @see https://docs.aws.amazon.com/AmazonS3/latest/API/sig-v4-header-based-auth.html\n *\n * @internal\n */\nconst contentSha256MiddlewareFactory = () => (next) => async function contentSha256Middleware(request) {\n    if (request.headers[constants_1.CONTENT_SHA256_HEADER]) {\n        return next(request);\n    }\n    else {\n        const hash = await (0, aws_client_utils_1.getHashedPayload)(request.body);\n        request.headers[constants_1.CONTENT_SHA256_HEADER] = hash;\n        return next(request);\n    }\n};\nexports.contentSha256MiddlewareFactory = contentSha256MiddlewareFactory;\n"],"names":[],"mappings":";;AACA;AACA;AACA,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;AAC7D,OAAO,CAAC,8BAA8B,GAAG,MAAM;AAC/C,MAAM,kBAAkB,GAAG,OAAO,CAAC,8CAA8C,CAAC;AAClF,MAAM,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,8BAA8B,GAAG,MAAM,CAAC,IAAI,KAAK,eAAe,uBAAuB,CAAC,OAAO,EAAE;AACvG,IAAI,IAAI,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,qBAAqB,CAAC,EAAE;AAC5D,QAAQ,OAAO,IAAI,CAAC,OAAO,CAAC;AAC5B;AACA,SAAS;AACT,QAAQ,MAAM,IAAI,GAAG,MAAM,IAAI,kBAAkB,CAAC,gBAAgB,EAAE,OAAO,CAAC,IAAI,CAAC;AACjF,QAAQ,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,qBAAqB,CAAC,GAAG,IAAI;AACjE,QAAQ,OAAO,IAAI,CAAC,OAAO,CAAC;AAC5B;AACA,CAAC;AACD,OAAO,CAAC,8BAA8B,GAAG,8BAA8B;;"}