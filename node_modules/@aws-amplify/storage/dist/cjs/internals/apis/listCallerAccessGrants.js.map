{"version":3,"file":"listCallerAccessGrants.js","sources":["../../../../src/internals/apis/listCallerAccessGrants.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.listCallerAccessGrants = void 0;\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst utils_2 = require(\"../../utils\");\nconst s3control_1 = require(\"../../providers/s3/utils/client/s3control\");\nconst StorageError_1 = require(\"../../errors/StorageError\");\nconst userAgent_1 = require(\"../../providers/s3/utils/userAgent\");\nconst constants_1 = require(\"../utils/constants\");\n/**\n * @internal\n */\nconst listCallerAccessGrants = async (input) => {\n    const { credentialsProvider, accountId, region, nextToken, pageSize, customEndpoint, } = input;\n    utils_2.logger.debug(`listing available locations from account ${input.accountId}`);\n    if (!!pageSize && pageSize > constants_1.MAX_PAGE_SIZE) {\n        utils_2.logger.debug(`defaulting pageSize to ${constants_1.MAX_PAGE_SIZE}.`);\n    }\n    const clientCredentialsProvider = async (options) => {\n        const { credentials } = await credentialsProvider(options);\n        return credentials;\n    };\n    const { CallerAccessGrantsList, NextToken, $metadata } = await (0, s3control_1.listCallerAccessGrants)({\n        credentials: clientCredentialsProvider,\n        customEndpoint,\n        region,\n        userAgentValue: (0, userAgent_1.getStorageUserAgentValue)(utils_1.StorageAction.ListCallerAccessGrants),\n    }, {\n        AccountId: accountId,\n        NextToken: nextToken,\n        MaxResults: pageSize ?? constants_1.MAX_PAGE_SIZE,\n        AllowedByApplication: true,\n    });\n    const accessGrants = CallerAccessGrantsList?.map(grant => {\n        assertGrantScope(grant.GrantScope, $metadata);\n        return {\n            scope: grant.GrantScope,\n            permission: grant.Permission,\n            type: parseGrantType(grant.GrantScope),\n        };\n    }) ?? [];\n    return {\n        locations: accessGrants,\n        nextToken: NextToken,\n    };\n};\nexports.listCallerAccessGrants = listCallerAccessGrants;\nconst parseGrantType = (grantScope) => {\n    const bucketScopeReg = /^s3:\\/\\/(.*)\\/\\*$/;\n    const possibleBucketName = grantScope.match(bucketScopeReg)?.[1];\n    if (!grantScope.endsWith('*')) {\n        return 'OBJECT';\n    }\n    else if (grantScope.endsWith('/*') &&\n        possibleBucketName &&\n        possibleBucketName.indexOf('/') === -1) {\n        return 'BUCKET';\n    }\n    else {\n        return 'PREFIX';\n    }\n};\nfunction assertGrantScope(value, responseMetadata) {\n    if (typeof value !== 'string' || !value.startsWith('s3://')) {\n        throw new StorageError_1.StorageError({\n            name: 'InvalidGrantScope',\n            message: `Expected a valid grant scope, got ${value}`,\n            metadata: responseMetadata,\n        });\n    }\n}\n"],"names":[],"mappings":"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"}