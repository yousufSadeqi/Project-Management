{"version":3,"file":"SessionListener.js","sources":["../../../../src/utils/sessionListener/SessionListener.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SessionListener = void 0;\nconst isBrowser_1 = require(\"../isBrowser\");\nconst stateChangeListeners = new Set();\nclass SessionListener {\n    constructor() {\n        this.listenerActive = false;\n        this.handleVisibilityChange = this.handleVisibilityChange.bind(this);\n        // Setup state listeners\n        if ((0, isBrowser_1.isBrowser)()) {\n            document.addEventListener('visibilitychange', this.handleVisibilityChange, false);\n            this.listenerActive = true;\n        }\n    }\n    addStateChangeListener(listener, notifyOnAdd = false) {\n        // No-op if document listener is not active\n        if (!this.listenerActive) {\n            return;\n        }\n        stateChangeListeners.add(listener);\n        // Notify new handlers of the current status on add\n        if (notifyOnAdd) {\n            listener(this.getSessionState());\n        }\n    }\n    removeStateChangeListener(handler) {\n        // No-op if document listener is not active\n        if (!this.listenerActive) {\n            return;\n        }\n        stateChangeListeners.delete(handler);\n    }\n    handleVisibilityChange() {\n        this.notifyHandlers();\n    }\n    notifyHandlers() {\n        const sessionState = this.getSessionState();\n        stateChangeListeners.forEach(listener => {\n            listener(sessionState);\n        });\n    }\n    getSessionState() {\n        if ((0, isBrowser_1.isBrowser)() && document.visibilityState !== 'hidden') {\n            return 'started';\n        }\n        // If, for any reason, document is undefined the session will never start\n        return 'ended';\n    }\n}\nexports.SessionListener = SessionListener;\n"],"names":[],"mappings":";;AACA;AACA;AACA,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;AAC7D,OAAO,CAAC,eAAe,GAAG,MAAM;AAChC,MAAM,WAAW,GAAG,OAAO,CAAC,cAAc,CAAC;AAC3C,MAAM,oBAAoB,GAAG,IAAI,GAAG,EAAE;AACtC,MAAM,eAAe,CAAC;AACtB,IAAI,WAAW,GAAG;AAClB,QAAQ,IAAI,CAAC,cAAc,GAAG,KAAK;AACnC,QAAQ,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,IAAI,CAAC;AAC5E;AACA,QAAQ,IAAI,IAAI,WAAW,CAAC,SAAS,GAAG,EAAE;AAC1C,YAAY,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,IAAI,CAAC,sBAAsB,EAAE,KAAK,CAAC;AAC7F,YAAY,IAAI,CAAC,cAAc,GAAG,IAAI;AACtC;AACA;AACA,IAAI,sBAAsB,CAAC,QAAQ,EAAE,WAAW,GAAG,KAAK,EAAE;AAC1D;AACA,QAAQ,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;AAClC,YAAY;AACZ;AACA,QAAQ,oBAAoB,CAAC,GAAG,CAAC,QAAQ,CAAC;AAC1C;AACA,QAAQ,IAAI,WAAW,EAAE;AACzB,YAAY,QAAQ,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;AAC5C;AACA;AACA,IAAI,yBAAyB,CAAC,OAAO,EAAE;AACvC;AACA,QAAQ,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;AAClC,YAAY;AACZ;AACA,QAAQ,oBAAoB,CAAC,MAAM,CAAC,OAAO,CAAC;AAC5C;AACA,IAAI,sBAAsB,GAAG;AAC7B,QAAQ,IAAI,CAAC,cAAc,EAAE;AAC7B;AACA,IAAI,cAAc,GAAG;AACrB,QAAQ,MAAM,YAAY,GAAG,IAAI,CAAC,eAAe,EAAE;AACnD,QAAQ,oBAAoB,CAAC,OAAO,CAAC,QAAQ,IAAI;AACjD,YAAY,QAAQ,CAAC,YAAY,CAAC;AAClC,SAAS,CAAC;AACV;AACA,IAAI,eAAe,GAAG;AACtB,QAAQ,IAAI,IAAI,WAAW,CAAC,SAAS,GAAG,IAAI,QAAQ,CAAC,eAAe,KAAK,QAAQ,EAAE;AACnF,YAAY,OAAO,SAAS;AAC5B;AACA;AACA,QAAQ,OAAO,OAAO;AACtB;AACA;AACA,OAAO,CAAC,eAAe,GAAG,eAAe;;"}