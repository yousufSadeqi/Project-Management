{"version":3,"file":"amzSdkRequestHeaderMiddleware.js","sources":["../../../../../src/clients/middleware/retry/amzSdkRequestHeaderMiddleware.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.amzSdkRequestHeaderMiddlewareFactory = void 0;\nconst constants_1 = require(\"./constants\");\n/**\n * Middleware injects `amz-sdk-request` header to indicate the retry state at the time an HTTP request is made.\n * This middleware should co-exist with retryMiddleware as it relies on the retryAttempts value in middleware context\n * set by the retry middleware.\n *\n * Example header: `amz-sdk-request: attempt=1; max=3`.\n *\n * This middleware is standalone because of extra headers may conflict with custom endpoint settings(e.g. CORS), we will\n * NOT use this middleware for API categories.\n */\nconst amzSdkRequestHeaderMiddlewareFactory = ({ maxAttempts = constants_1.DEFAULT_RETRY_ATTEMPTS }) => (next, context) => {\n    return async function amzSdkRequestHeaderMiddleware(request) {\n        const attemptsCount = context.attemptsCount ?? 0;\n        request.headers[constants_1.AMZ_SDK_REQUEST_HEADER] =\n            `attempt=${attemptsCount + 1}; max=${maxAttempts}`;\n        return next(request);\n    };\n};\nexports.amzSdkRequestHeaderMiddlewareFactory = amzSdkRequestHeaderMiddlewareFactory;\n"],"names":[],"mappings":";;AACA;AACA;AACA,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;AAC7D,OAAO,CAAC,oCAAoC,GAAG,MAAM;AACrD,MAAM,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,oCAAoC,GAAG,CAAC,EAAE,WAAW,GAAG,WAAW,CAAC,sBAAsB,EAAE,KAAK,CAAC,IAAI,EAAE,OAAO,KAAK;AAC1H,IAAI,OAAO,eAAe,6BAA6B,CAAC,OAAO,EAAE;AACjE,QAAQ,MAAM,aAAa,GAAG,OAAO,CAAC,aAAa,IAAI,CAAC;AACxD,QAAQ,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,sBAAsB,CAAC;AAC3D,YAAY,CAAC,QAAQ,EAAE,aAAa,GAAG,CAAC,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;AAC9D,QAAQ,OAAO,IAAI,CAAC,OAAO,CAAC;AAC5B,KAAK;AACL,CAAC;AACD,OAAO,CAAC,oCAAoC,GAAG,oCAAoC;;"}