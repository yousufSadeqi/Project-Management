{"version":3,"file":"list.js","sources":["../../../../../src/runtime/internals/operations/list.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.listFactory = listFactory;\nconst APIClient_1 = require(\"../APIClient\");\nconst utils_1 = require(\"./utils\");\nconst utils_2 = require(\"../../utils\");\nconst cancellation_1 = require(\"../cancellation\");\nconst getCustomUserAgentDetails_1 = require(\"../ai/getCustomUserAgentDetails\");\nfunction listFactory(client, modelIntrospection, model, getInternals, context = false, customUserAgentDetails) {\n    const listWithContext = (contextSpec, args) => {\n        return _list(client, modelIntrospection, model, getInternals, args, contextSpec, customUserAgentDetails);\n    };\n    const list = (args) => {\n        return _list(client, modelIntrospection, model, getInternals, args, undefined, customUserAgentDetails);\n    };\n    return context ? listWithContext : list;\n}\nfunction _list(client, modelIntrospection, model, getInternals, args, contextSpec, customUserAgentDetails) {\n    return (0, utils_2.selfAwareAsync)(async (resultPromise) => {\n        const { name } = model;\n        const query = (0, APIClient_1.generateGraphQLDocument)(modelIntrospection, model, 'LIST', args);\n        const variables = (0, APIClient_1.buildGraphQLVariables)(model, 'LIST', args, modelIntrospection);\n        const auth = (0, APIClient_1.authModeParams)(client, getInternals, args);\n        const headers = (0, APIClient_1.getCustomHeaders)(client, getInternals, args?.headers);\n        const userAgentOverride = (0, getCustomUserAgentDetails_1.createUserAgentOverride)(customUserAgentDetails);\n        try {\n            const basePromise = contextSpec\n                ? client.graphql(contextSpec, {\n                    ...auth,\n                    query,\n                    variables,\n                }, headers)\n                : client.graphql({\n                    ...auth,\n                    query,\n                    variables,\n                    ...userAgentOverride,\n                }, headers);\n            const extendedPromise = (0, cancellation_1.extendCancellability)(basePromise, resultPromise);\n            const { data, extensions } = await extendedPromise;\n            // flatten response\n            if (data !== undefined) {\n                const [key] = Object.keys(data);\n                if (data[key].items) {\n                    const flattenedResult = data[key].items.map((value) => (0, APIClient_1.flattenItems)(modelIntrospection, name, value));\n                    // don't init if custom selection set\n                    if (args?.selectionSet) {\n                        return {\n                            data: flattenedResult,\n                            nextToken: data[key].nextToken,\n                            extensions,\n                        };\n                    }\n                    else {\n                        const initialized = (0, APIClient_1.initializeModel)(client, name, flattenedResult, modelIntrospection, auth.authMode, auth.authToken, !!contextSpec);\n                        return {\n                            data: initialized,\n                            nextToken: data[key].nextToken,\n                            extensions,\n                        };\n                    }\n                }\n                return {\n                    data: data[key],\n                    nextToken: data[key].nextToken,\n                    extensions,\n                };\n            }\n        }\n        catch (error) {\n            /**\n             * The `data` type returned by `error` here could be:\n             * 1) `null`\n             * 2) an empty object\n             * 3) \"populated\" but with a `null` value `data: { listPosts: null }`\n             * 4) actual records `data: { listPosts: items: [{ id: '1', ...etc }] }`\n             */\n            const { data, errors } = error;\n            // `data` is not `null`, and is not an empty object:\n            if (data !== undefined &&\n                data !== null &&\n                Object.keys(data).length !== 0 &&\n                errors) {\n                const [key] = Object.keys(data);\n                if (data[key]?.items) {\n                    const flattenedResult = data[key].items.map((value) => (0, APIClient_1.flattenItems)(modelIntrospection, name, value));\n                    /**\n                     * Check exists since `flattenedResult` could be `null`.\n                     * if `flattenedResult` exists, result is an actual record.\n                     */\n                    if (flattenedResult) {\n                        // don't init if custom selection set\n                        if (args?.selectionSet) {\n                            return {\n                                data: flattenedResult,\n                                nextToken: data[key]?.nextToken,\n                                errors,\n                            };\n                        }\n                        else {\n                            const initialized = (0, APIClient_1.initializeModel)(client, name, flattenedResult, modelIntrospection, auth.authMode, auth.authToken, !!contextSpec);\n                            // data is full record w/out selection set:\n                            return {\n                                data: initialized,\n                                nextToken: data[key]?.nextToken,\n                                errors,\n                            };\n                        }\n                    }\n                    return {\n                        data: data[key],\n                        nextToken: data[key]?.nextToken,\n                        errors,\n                    };\n                }\n                else {\n                    // response is of type `data: { getPost: null }`)\n                    return (0, utils_1.handleListGraphQlError)(error);\n                }\n            }\n            else {\n                // `data` is `null` or an empty object:\n                return (0, utils_1.handleListGraphQlError)(error);\n            }\n        }\n    });\n}\n"],"names":[],"mappings":"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"}